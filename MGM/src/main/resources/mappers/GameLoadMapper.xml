<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.mgm.www.mapper.GameLoadMapper">
	<select id="loadGameScenes" parameterType="int" resultType="gnode">
		SELECT
			nodeid, 
			parentid, 
			nodename
		FROM
			game_node
		WHERE
			gameid = #{gameid}
		ORDER BY
			parentid NULLS FIRST, nodeid
	</select>
	
	<select id="editScene" parameterType="int" resultMap="selectNodeResult">
		SELECT
		    g.userid, n.nodename, n.nodecontent
		FROM
		    game_node n
		LEFT JOIN
		    games g
		ON
		    n.gameid = g.gameid
		WHERE
		    n.nodeid = #{nodeid}
	</select>	
	<resultMap id="selectNodeResult" type="hashmap">
		<result property="userid" column="userid" javaType="string"/>
		<result property="nodename" column="nodename" javaType="string"/>
		<result property="nodecontent" column="nodecontent" jdbcType="CLOB" javaType="string" />
	</resultMap>
	
	<select id="getChildnode" parameterType="int" resultType="int">
		SELECT
			nodeid
		FROM
			game_node
		WHERE
			parentid = ${parentid}
		ORDER BY
			nodeid
	</select>
	
	<insert id="saveGameScene" parameterType="gnode">
		INSERT INTO 
			game_node(
				gameid, 
				nodeid, 
				parentid, 
				nodename,
				nodecontent
			)
		VALUES(
			#{gameid}, 
			seq_nodeid.nextval, 
			#{parentid}, 
			'SceneName',
			#{nodecontent}
		)
	</insert>
	
	<update id="updateNodeContent" parameterType="gnode">
		UPDATE 
			game_node
		SET
			nodename = ${nodename},
			nodecontent=${nodecontent}
		WHERE
			nodeid=${nodeid}
	</update>
	
	<delete id="deleteNode" parameterType="int">
		DELETE FROM
			game_node
		WHERE
			nodeid = ${nodeid}
	</delete>
</mapper>